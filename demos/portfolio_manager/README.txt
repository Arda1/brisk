Brisk Portfolio Manager Demo
============================

The portfolio manager application demonstrates a hybrid workflow using Brisk. 
The use case is a financial application where users can actively create and manage a portfolio of stocks.

On the Cassandra OLTP side, each portfolio contains a list of stocks, the number of shares purchased, 
and the price at which the shares were purchased. 
A live stream of data simulates an active stock market, and updates each portfolio based on its overall 
value and the percentage of gain or loss compared to the purchase price. 

Historical market data is tracked for each stock (the end-of-day price) going back in time.

In the demo, simulated real-time stock data is generated by the ./bin/pricer utility. 
This utility generates portfolios, live stock prices, and historical market data.

On the Brisk OLAP side, a Hive MapReduce job is used to calculate the greatest historical 10 day loss period for each portfolio, 
which is an indicator of the risk associated with a portfolio. 
This information is then fed back into the real-time application to allow customers to better gage their potential losses.


Running the Portfolio Manager Demo
==================================
Before you begin, make sure you have installed, configured, and started Brisk on either a single node or a cluster. 
If running the demo on a cluster, install and run the demo from the Brisk Job Tracker (seed) node.

Go to the portfolio manager demo directory.
    cd /usr/share/brisk-demos/portfolio_manager
or
    cd $BRISK_HOME/demos/portfolio_manager

1. Build the demo.
    ant

2. Run the ./bin/pricer utility to generate stock data for the OLTP application. To see all of the available options for this utility:
    ./bin/pricer --help

The following example will generate 100 days worth of historical data. 
If running on a single node cluster on localhost, you do not need the -d option, 
otherwise supply the internal IP address of the Cassandra node where you are running the demo. 
For example:

    ./bin/pricer -d 127.0.0.1 -o INSERT_PRICES
    ./bin/pricer -d 127.0.0.1 -o UPDATE_PORTFOLIOS
    ./bin/pricer -d 127.0.0.1 -o INSERT_HISTORICAL_PRICES -n 100

3. Start the web service.
   cd website
   java -jar start.jar
   Open a browser and go to http://localhost:8983/portfolio to see the real-time Portfolio Manager demo application.

   Open another shell window.

4. Start Hive and run the MapReduce job for the demo in Hive.

   brisk hive -f /usr/share/brisk-demos/portfolio_manager/10_day_loss.q
or for binary installations:

  $BRISK_HOME/bin/brisk hive -f $BRISK_HOME/demos/portfolio_manager/10_day_loss.q

The MapReduce job will take several minutes to run. Open the URL http://localhost:50030/jobtracker.jsp in a browser to watch the progress in the Job Tracker.
After the job completes, refresh the Portfolio Manager web page to see the results of Largest Historical 10day Loss for each portfolio.


