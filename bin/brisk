#!/bin/sh

if [ "x$BRISK_ENV" = "x" ]; then
    for include in /etc/brisk/brisk-env.sh \
                   ~/.brisk-env.sh \
                   `dirname $0`/brisk-env.sh; do
        if [ -r $include ]; then
            . $include
            break
        fi
    done
elif [ -r $BRISK_ENV ]; then
    . $BRISK_ENV
fi

BIN=`dirname $0`

update_jobtracker()
{
    JOBTRACKER=`$BIN/brisktool jobtracker`;
    
    if [ "x$JOBTRACKER" = "x" ]; then
	echo "error finding jobtracker address"
	exit 1
    else
	sed -e "s/<!--brisk jobtracker-->/$JOBTRACKER/g" $HADOOP_HOME/conf/mapred-site.xml.brisk > $HADOOP_HOME/conf/mapred-site.xml
    fi
}


if [ "x$1" = "xcassandra" ]; then
    shift
    $CASSANDRA_BIN/cassandra $* -Djava.library.path=$JAVA_LIBRARY_PATH
    exit $?
fi

if [ "x$1" = "xhadoop" ]; then
    shift

    update_jobtracker

    $HADOOP_BIN/hadoop $*    
    exit $?
fi

if [ "x$1" = "xhive" ]; then
    shift

    #we need to remove the conflicting antlr jar
    export CLASSPATH=`echo $CLASSPATH | sed -E "s/antlr|slf4j/dne/g"`
    export HADOOP_CLASSPATH=$CLASSPATH

    update_jobtracker
    
    $HIVE_BIN/hive -hiveconf hive.log.dir=$BRISK_LOG_ROOT/hive -hiveconf brisk.home=$BRISK_HOME $*
    exit $?
fi

echo "$0: cassandra [options] | hadoop [options] | hive [options]"
exit 1

# vi:ai sw=4 ts=4 tw=0 et
